---
description: >-
  Configurações necessárias para virtualização do sistema operacional de forma a
  deixá-lo pronto para seu uso em uma análise de malware
---

# Configurando Maquina Virtual

Primeiro precisamos recorrer a ferramentas de virtualização de sistemas operacionais em nosso ambiente; no mundo ideal teríamos uma máquina host física completamente separada apenas para estes casos, mas para começar podemos começar com a virtualização mesmo. É extremamente importante utilizarmos uma maquina virtual e as devidas configurações de isolamento desta máquina na rede pois se o arquivo for realmente malicioso pode infectar a maquina host e se perpetrar pela rede. Por isso é importante termos ciencia das configurações corretas na hora de analisar um arquivo suspeito.

Algumas das ferramentas que podemos utilizar para virtualizar são:

* VMware Workstation (que se não me engano agora tem sua versão Pro liberada para uso não comercial)
* VMware Fusion
* Oracle VirtualBox
* QEMU

Primeiro precisamos ter posse da ISO do sistema operacional que iremos utilizar, as ISOs podem ser baixadas em diversos sites e existem ferramentas que proporcionam o processo de criação de uma midia de instalação, que ao final, gerará uma ISO (no caso do Windows, por exemplo, que precisa da ferramenta de criação de mídia). Ao instalar a ISO em seu utlitário de vitualização preferido, instale também as ferramentas mencionadas no artigo [softwares.md](softwares.md "mention"), isso proporcionará as configurações necessárias para se fazer uma analise detalhada, em seguida é fundamental desabilitar as ferramentas de prevenção de malware no sistema operacional, pois o sistema pode detectar o arquivo suspeito e removê-lo antes que possamos nos certificar de seu comportamento.

* Windows&#x20;
  * Turn off anti-malware solutions
  * Disable Windows Defender Using Group Policy
  * Disable Monitor file and program activity
  * Rename your virtual operating system
  * Turn off auto updates
  * Disable Hidden Extensions
    * Change folder and search options from File Explorer
    * Hide extensions for known file types
  * Show Hidden Files and Folders
  * Disable ASLR
    * O processo consistem em acessar  “HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management”
    * criar uma "REG\_DWORD” de key name “MoveImages”
  * Disable Windows Firewall
  * Mimic an End-User System
    * Installing browsers frequently preferred by end-users such as Chrome and Firefox, Leaving files in different directories that will be of interest to the attacker, Changing the desktop background, To ensure that some files are found in the Downloads directory by downloading small applications through the browser
  * Por fim precisamos mudar a configuração de rede da maquina virtual no utilitário de virtualização (Virtual Box ou VMWare, por exemplo) para uma rede criada exclusivamente para o experimento (rede customizada) e criar um snapshot da máquina antes de transferir o arquivo suspeito para a VM.



