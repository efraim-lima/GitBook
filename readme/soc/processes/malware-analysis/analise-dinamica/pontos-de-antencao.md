# Pontos de Antenção

O processo de análise de malware pode ser complexo e repleto de minucias inerentes à analise de uma aplicaçao robusta. Para tal precisamos ter conhecimento prévio de como algumas aplicações funcionam e é imprescindível ter a habilidade de abstrair as reais atividades de uma apicação dentro do sistema para não sermos facilmente enganados pelos gentes maliciosos. Portanto precisamos ter atenção a alguns elementos que uma aplicaçao interage com o Sistema Operacional que podem dar indícios de suas intenções, tais elementos resumem-se a atividades de:

*   **Processos**\
    Toda aplicação no sistema operacional cria processos correlacionados a atividade principal, para analisarmos uma aplicação precisamos:

    * encontrar processos que pertençam ao executavel principal
    * analisar os processos filhos (child processes)
    * analisar as DLLs importadas pelo processo como um todo&#x20;
    * analisar qual usuário está sendo usado para rodar este processo

    Podemos usar uma ferramenta chamada Process Hacker no Windows e para o Linux podemos usar ferramentas como o htop, top, vtop e glances ou até mesmo comados como '''ps -axjf'''.&#x20;
* Ao começar a analise de um processo precisamos entender que um malware pode se replicar para outro processos para tentar se ocultar, com isso precisamos ter consciência que devemos analisar cada processo presente na árvore de proecessos do arquivo suspeito e precisamos monitorá-la desde seu início para capturar eventuais novas threads que os processos possam abrir e analisar uma a uma.
* **Redes**\
  Como qualquer aplicação que precise fazer comunicação externa, um malware com essas intenções também deixaria rastros em rede como conexões com endereços IP ou domínios suspeitos, para isso temos algumas ferramentas que podem nos ajudar, tais são: Wireshark, Burp Suite e Fiddler. Malwares podem usar protocolos como HTTP, SMTP  e precisam tecer conexões externas para se comunicar com servidores de comando e controle, por exemplo.
*   **Registros no SO**\
    O processo de registros no Windows funciona como um database que armazena configurações e funções do sistema operacional, sendo fundamentais para o funcionamento e para configurações de software e hardware no Windows, para analisarmos e editarmos basta irmos ao utilitário regedit; portanto os registros podem ser modificados para garantir persistencia de um malware no sistema operacional.\
    Registros armazenam informações de configurações do sistema, gerencia aplicativos, faz associações entre arquivos e manipula drivers e hardware.\
    Para termos uma noção do que cada registry pode conter no Windows:

    * **HKEY\_CLASSES\_ROOT (HKCR):** Contém informações sobre as associações de arquivos e as classes COM (Component Object Model).
    * **HKEY\_CURRENT\_USER (HKCU):** Armazena configurações e preferências do usuário atual.
    * **HKEY\_LOCAL\_MACHINE (HKLM):** Contém configurações de sistema e informações de hardware que se aplicam a todos os usuários do computador.
    * **HKEY\_USERS (HKU):** Armazena configurações específicas de cada usuário.
    * **HKEY\_CURRENT\_CONFIG (HKCC):** Contém informações sobre a configuração de hardware atual.

    Aqui podemos analisar o Registry e Regshot (iniciando a primeira captura antes de rodar o malware e a segunda após rodar o malware no sistema) do Windows ou então os arquivos presentes nas pastas /etc e  /proc no linux em busca de arquivos de configuração e hidden (ocultos) que possam conter configurações de aplicações.&#x20;
* **Atividade dos Arquivos**\
  Maior parte dos malwares realizam atividades nos arquivos do sistema operacional (alguns atacantes desenvolveram malwares fileless para dificultar sua detecção no sistema), mas geralmente essas atividades são executadas nas pastas /temp do sistema operacional, onde geralmente todas aplicações usam para manter recursos que precisam ficar armazenados no sistema de forma temporária. No Windows conseguimos acessar estes arquivos digitando %temp% após teclar "Win + R"\
  Outro processo que um malware pode discorrer é\
  &#x20;no garantimento de sua persistência no sistema operacional, para isso ele tentará criar serviços no sistema ou alterar aplicações de inicialização que podem mantê-lo persistente no sistema. Para verificar isso basta digitarmos "shell:common startup" e/ou "shell:startup" no Windows.\
  Deixarei um fluxo mais fácil de ser seguido dos comandos aqui embaixo para deixar tudo mais fluido no processo.

_<mark style="background-color:orange;">**Preperação para análise de malware.**</mark>_

* **WINDOWS**
  *   Iniciar Aplicativos e seus processos de captura:

      Process Hacker\
      Process Monitor (procmon)\
      Wireshark\
      Fiddler\
      Regshot
  * Teclar "Win + R" e inciar:\
    %temp%\
    shell:startup\
    shell:common startup
* **LINUX**
  * Iniciar Aplicativos e seus processos de captura:\
    htop\
    Wireshark\
    Fiddler
  * Ir ao terminal e inciar:\
    glances\
    ps -axjf\
    auditd\
    lsof\
    diff\
    rsync\
    inotify-tools\
